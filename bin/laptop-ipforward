#!/usr/bin/env python
import os, sys
import subprocess

from optparse import OptionParser

parser = OptionParser()

opts, args = parser.parse_args(sys.argv[1:])

if os.getuid():
    raise RuntimeError, 'Need to be root for this'

if not len(args):
    raise RuntimeError, "Improper arguments.  Need at least one argument."

ifaces = ['eth0', 'wlan0']

def forward_iface(iface):
    if iface not in ifaces:
        raise RuntimeError, "Unknown interface %s" % iface
    cmd = ['iptables', '-t', 'nat', '-A', 'POSTROUTING', '-o', iface,
           '-j', 'MASQUERADE']
    subprocess.check_call(cmd)
    with file('/proc/sys/net/ipv4/ip_forward', 'w') as outfile:
        outfile.write('1\n')
        

if __name__ == '__main__':
    iface = args[0]
    forward_iface(iface)
    


